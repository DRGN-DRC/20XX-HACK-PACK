
Stage Swap Engine (v1.1)
Responsible for checking the current stage select screen and loading the appropriate pre-defined or random stage, as defined by the Stage Swap Info Table.

v1.1 of the code portion fixes random byte overwrites (when using 0xFF byte replacement mode).
[Achilles, DRGN]
Revision ---- DOL Offset ---- Hex to Replace ---------- ASM Code -
NTSC 1.02 --- 0x8025BB40 ---- 8804000B -> Branch

9421FFC0 BE810008
7C741B78 8AA4000B
1EF50030 3EC0803F
62D6BC20 7ED6BA14
3EE0803F 8AF70A20
3AF7FFCF 3B17000C
7F18B0AE 3F208040
9B19A2E5 3B170008
7F18B0AE 2C180000
41A2002C 7F15C378
2C15001A 40A20014
3F008040 82B8A280
3AB50021 48000010
2C150015 40A20008
3AA00000 1F170004
3B180010 7F16C02E
2C180000 41820080
3B370020 7F39B0AE
2C190000 41820070
2C1900FF 40820058
2C170000 41820060
38600000 3B200004
7F2903A6 1F370004
3B390020 7F59B0AE
2C1A0000 41820010
38630001 3B390001
4200FFEC 3C808038
60840580 7C8803A6
4E800021 1F370004
3B430020 7F5ACA14
7F3AB0AE 7F03C378
48000179 9B380000
48000184 1C95000C
3C60803E 60639960
7C63202E 3C80803E
3884FEDC 5463103A
7F03202E 83180008
2C180000 41820140
3B2000FF 2C150002
40A2000C 3F208040
8339A1DC 2C150003
40A2000C 3F208040
8339A1D4 2C150008
40A2000C 3F208040
8339A1E0 2C15001C
40A2000C 3F208040
8339A1D8 2C15001F
40A2000C 3F208040
8339A1E8 2C150020
40A2000C 3F208040
8339A1E4 3BE00000
2C1900FF 40A20008
480000CC 7F3ACB78
2C19000F 4180001C
3860000F 3C808038
60840580 7C8803A6
4E800021 7C791B78
2C19000A 4080000C
3B390030 48000008
3B390037 7F03C378
3880002E 3CA08032
60A55878 7CA803A6
4E800021 2C030000
40A2000C 38780004
48000008 38630001
3BFF0001 2C1F0001
40820008 4800005D
9B230000 7F03C378
9421FFC0 BE810008
3C808001 60846204
7C8803A6 4E800021
3C808033 6084796C
7C8803A6 4E800021
BA810008 38210040
2C03FFFF 40820018
2C1A000F 41800008
4BFFFF50 3B200000
4BFFFF3C 48000018
3CA08040 9065C260
88C30000 98C5C264
4E800020 B2B4001E
3E808025 6294BB48
7E8803A6 BA810008
38210040 4E800020

------------- 0x803FBC70 ----

6174696F 5F31203A
00000000 4F666652
6174696F 5F32203A
00000000 4F666652
6174696F 5F33203A
00000000 4F666652
6174696F 5F34203A
00000000 00000000
00000000 803FBC58
00000000 00000000
00000000 00000000
00000000 00000008
00000000 803FBC6C
00000000 803FA2D0
00000000 40400000
3DCCCCCD 00000008
00000000 803FBC7C
00000000 803FA2D4
00000000 40400000
3DCCCCCD 00000008
00000000 803FBC8C
00000000 803FA2D8
00000000 40400000
3DCCCCCD 00000008
00000000 803FBC9C
00000000 803FA2DC
00000000 40400000
3DCCCCCD 00000009
00000000 00000000
00000000 00000000
00000000 00000000
00000000 3C204465
66656E63 65205261
74696F20 3E000000
44656652 6174696F
5F31203A 00000000
44656652 6174696F
5F32203A 00000000
44656652 6174696F
5F33203A 00000000
44656652 6174696F
5F34203A 00000000
00000000 00000000
803FBD6C 00000000
00000000 00000000
00000000 00000000
00000008 00000000
803FBD80 00000000
803FA2E0 00000000
40400000 3DCCCCCD
00000008 00000000
803FBD90 00000000
803FA2E4 00000000
40400000 3DCCCCCD
00000008 00000000
803FBDA0 00000000
803FA2E8 00000000
40400000 3DCCCCCD
00000008 00000000
803FBDB0 00000000
803FA2EC 00000000
40400000 3DCCCCCD
00000009 00000000
00000000 00000000
00000000 00000000
00000000 00000000
43705470 5F537461
79202000 43705470
5F57616C 6B202000
43705470 5F457363
61706500 43705470
5F4A756D 70202000
43705470 5F4E6F72
6D616C00 43705470
5F4D616E 75616C00
43705470 5F4E616E
61202000 43705470
5F446566 656E7369
76650000 43705470
5F537472 7567676C
65000000 43705470
5F467265 616B2000
43705470 5F436F6F
70657261 74650000
43705470 5F53704C
774C696E 6B000000
43705470 5F53704C
7753616D 75730000
43705470 5F4F6E6C
79497465 6D000000
43705470 5F45765A
656C6461 00000000
43705470 5F4E6F41
63740000 43705470
5F416972 00000000
43705470 5F497465
6D000000 803FBE80
803FBE8C 803FBE98
803FBEA4 803FBEB0
803FBEBC 803FBEC8
803FBED4 803FBEE4
803FBEF4 803FBF00
803FBF10 803FBF20
803FBF30 803FBF40
803FBF50 803FBF5C
803FBF68 3C204370
75205479 7065203E
00000000 54797065
5F5F4331 203A0000
54797065 5F5F4332
203A0000 54797065
5F5F4333 203A0000
54797065 5F5F4334
203A0000 00000000
00000000 803FBFBC
00000000 00000000
00000000 00000000
00000000 00000002
00000000 803FBFCC
803FBF74 803FA300
00000000 41900000
00000000 00000002
00000000 803FBFD8
803FBF74 803FA304
00000000 41900000
00000000 00000002
00000000 803FBFE4
803FBF74 803FA308
00000000 41900000
00000000 00000002
00000000 803FBFF0
803FBF74 803FA30C
00000000 41900000
00000000 00000009
00000000 00000000
00000000 00000000
00000000 00000000
00000000 3C204370
75204C65 76656C20
3E000000 4C657665
6C5F4331 203A0000
4C657665 6C5F4332
203A0000 4C657665
6C5F4333 203A0000
4C657665 6C5F4334
203A0000 00000000
00000000 803FC0BC
00000000 00000000
00000000 00000000
00000000 00000003
00000000 803FC0CC
00000000 803FA310
00000000 41100000
3F800000 00000003
00000000 803FC0D8
00000000 803FA314
00000000 41100000
3F800000 00000003
00000000 803FC0E4
00000000 803FA318
00000000 41100000
3F800000 00000003
00000000 803FC0F0
00000000 803FA31C
00000000 41100000
3F800000 00000009
00000000 00000000
00000000 00000000
00000000 00000000
00000000 5265642D
5465616D 00000000
47726565 6E2D5465
616D0000 426C7565
2D546561 6D000000
803FC1BC 803FC1C8
803FC1D4 3C205465
616D2053 656C6563
74203E00 5465616D
5F31203A 00000000
5465616D 5F32203A
00000000 5465616D
5F33203A 00000000
5465616D 5F34203A
00000000 00000000
00000000 803FC1EC
00000000 00000000
00000000 00000000
00000000 00000002
00000000 803FC1FC
803FC1E0 803FA2B0
00000000 40400000
00000000 00000002
00000000 803FC208
803FC1E0 803FA2B4

 -> 

# Stage Swap Table
3C53544147455357415020494E464F3E
464F554E5441494E0000002900000000 # Fountain
0000000000000000803E0E56803E8C07
0000676D000000000000000000000000
504F4B45535441440000000000000800 # Stadium
000000000000000000000000804D45EC
00000067000000000000000000000000
505020434153544C0039E30000000000 # Peach's Castle
00000000803E981700000000803E119E
006B0030000000000000000000000000
4B204A554E474C45001D000D00000000 # Kongo Jungle
00000000803E6506803E17FA803E3F66
00776831000000000000000000000000
4252494E53544152003F002700008000 # Brinstar
000000000000000000000000803E8A2F
00000030000000000000000000000000
434F524E45524941002C00000000C000 # Corneria
00000000803E8E4700000000804D4654
006D0030000000000000000000000000
592053544F5259000000001F00000000 # Yoshi's Story
0000000000000000803E2746803E7E33
00006774000000000000000000000000
4F4E455454000000003F420E00020000 # Onett
000000000000000000000000803E512A
0000006D000000000000000000000000
4D55544543495459001F032400004010 # Mute City
00000000803E7E3300000000803E87E7
006C0030000000000000000000000000
52204352554953450010D72B00000000 # Rainbow Cruise
00000000803E51C600000000803E8D87
00310030000000000000000000000000
4A204A415045530000001A2F0000FF00 # Jungle Japes
000000000000000000000000803E9087
00000030000000000000000000000000
4752544241590000003B000000000000 # Great Bay
0000000000000000803E3F66803E3F66
00006830000000000000000000000000
482054454D504C450030000000000000 # Hyrule Temple
00000000803E9147803E512A803E512A
00687330000000000000000000000000
4252494E20444550003F553500038000 # Brinstar Depths
0000000000000000803E84BE803E950F
00003063000000000000000000000000
594F53482049534C00121F0000004100 # Yoshi's Island
00000000803E3D8E00000000803E51C6
003100FF000000000000000032333400
475245454E20475200001F1300008100 # Green Greens
00000000803E76CA00000000803E494A
003100FF000000000000000031313132
464F555253494445003F540000040000 # Fourside
000000000000000000000000803E3D8E
00000032000000000000000000000000
4D555348204B31000003030000801000 # Mushroom Kingdom I
00000000804D45EC00000000803E494A
006E0030000000000000000000000000
4D555348204B32000003012500200000 # Mushroom Kingdom II
000000000000000000000000803E88A7
00000030000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
56454E4F4D00000000231F350000C100 # Venom
00000000803E872700000000803E950F
00730030000000000000000000000000
504F4B4520464C540053522200800000 # Pokefloats
000000000000000000000000803E865F
00000067000000000000000000000000
42494720424C55450023492900000000 # Big Blue
00000000803E872700000000803E8C07
006200FF000000000000000067686900
494349434C45204D002CF82200000000 # Icicle Mountain
00000000803E8E4700000000803E865F
00310073000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
00000000000000000000000000000000
464C41545A4F4E45002AE93A00000000 # Flatzone
00000000803E8CC700000000803E98D7
006D0030000000000000000000000000
445245414D4C36340000000000000000 # Dreamland 64
0000000000000000803E6742803E6742
00006B67000000000000000000000000
594F534849203634001C002000000000 # Yoshi's Story 64
00000000803E6742803E6506803E7F8B
00726868000000000000000000000000
4B4F4E474F2036340000003700000000 # Kongo Jungle 64
0000000000000000803E65E2803E968F
00003070000000000000000000000000
424154544C4546440000232000000000 # Battlefield
0000000000000000803E8727803E7F8B
0000676F000000000000000000000000
46494E414C204400000000000000C000 # Final Destination
000000000000000000000000803E7F8B
00000067000000000000000000000000
5354414745205357415020464C414753 # STAGE SWAP FLAGS
00000000000000000000000000000000
454E4420535441474520535741500000 # END STAGE SWAP

------------- 0x80018130 ---- 807E0014 -> Branch

# Stage File Patches
809E0010 80840004
81C40000 3DE00006
61EFE64B 7C0E7800
4082002C 3DC00003
61CE20E8 7DC47214
3DE0C3BB 91EE0000
91EE0004 3DE043BB
91EE0008 91EE000C
4800013C 3DE00009
61EF5335 7C0E7800
408200E8 3E008040
89F0A2E5 55EF0631
418200A0 3DE04040
3A200000 6230F488
7DE4812E 6230F4CC
7DE4812E 6230F4D0
7DE4812E 6230F590
7DE4812E 3E000001
62100088 7DE4812E
3E000001 62100608
7DE4812E 3DE04248
6230F4D8 7DE4812E
3E000005 62101B90
7E24812E 3E200005
3DE0C3AA 61EF91EC
62301F20 7DE4812E
3DE043AA 61EF91EC
62301F60 7DE4812E
3DE0C3D0 61EF91EC
62301FA0 7DE4812E
3DE043D0 61EF91EC
62301FE0 7DE4812E
3DE08040 81CFA3A4
2C0E0000 41820028
81CFA3A0 99C47974
99C47B84 81CFA39C
99C47975 99C47B85
81CFA398 99C47976
99C47B86 48000048
3DE00016 61EF4B20
7C0E7800 40820038
3E008040 89F0A2E5
55EF0679 41820028
3DE00003 61EFDB88
7C8F2214 39E00000
91E40000 91E40004
91E40010 91E40014
91E40018 807E0014
48000000

